<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | THE SCENERY VINTAGE FARM</title>

<link rel="manifest" href="/TRO/manifest.json">
<meta name="theme-color" content="#111111">

<style>
*{box-sizing:border-box}
body{margin:0;background:#f0f1f3;font-family:Segoe UI,Tahoma,sans-serif;color:#222}
.page{max-width:1800px;margin:32px auto;background:#fff;padding:32px 36px;border-radius:16px}
.header{display:flex;justify-content:space-between;align-items:flex-end;border-bottom:1px solid #d6d9de;padding-bottom:16px}
.header-right{display:flex;gap:20px}
label{font-size:12px;font-weight:600;color:#555}
input,textarea{width:100%;padding:6px 8px;border:1px solid #d1d5db;border-radius:8px;font-size:12px}
textarea{resize:vertical}
.card{margin-top:24px;background:#fafafa;padding:20px;border-radius:16px}
table{width:100%;border-collapse:collapse;font-size:12px}
th{background:#2f2f2f;color:#fff;padding:8px}
td{padding:6px;border-bottom:1px solid #e5e7eb;vertical-align:top}
.btn{padding:8px 18px;border-radius:12px;font-weight:600;border:none;cursor:pointer}
.btn.add{background:#e6e8ec}
.btn-del{background:#fee2e2;border-radius:8px;padding:4px 8px}
.actions{margin-top:20px;display:flex;justify-content:space-between;align-items:center}
.img-box{width:130px;height:130px;border:2px dashed #94a3b8;border-radius:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;overflow:hidden}
.img-box img{width:100%;height:100%;object-fit:cover}
.img-hint{font-size:11px;color:#64748b}
.sub-row td{background:#f9fafb}

/* popup */
.popup-backdrop{
  position:fixed;inset:0;
  background:rgba(0,0,0,.45);
  backdrop-filter:blur(2px);
  display:none;align-items:center;justify-content:center;
  z-index:3000;
}
.popup{
  background:#fff;
  border-radius:18px;
  padding:24px;
  width:340px;
  text-align:center;
  transform:translateY(20px) scale(.95);
  opacity:0;
  transition:.25s ease;
}
.popup.show{transform:none;opacity:1}
.popup-actions{display:flex;gap:10px;justify-content:center;margin-top:18px}
.popup .danger{background:#dc2626;color:#fff}
.popup .primary{background:#2563eb;color:#fff}
.popup .ghost{background:#e5e7eb}

@media print{button{display:none!important}}
</style>
</head>
<body>

<div class="page">
  <div class="header">
    <h2>‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
    <div class="header-right">
      <div><label>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label><input type="month" id="monthPicker"></div>
      <div><label>‡πÅ‡∏ú‡∏ô‡∏Å</label><input id="deptInput"></div>
    </div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>#</th><th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th><th>‡∏£‡∏π‡∏õ</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
          <th>‡∏ã‡∏∑‡πâ‡∏≠</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏£‡∏ß‡∏°</th><th>‡∏•‡∏ö</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <button class="btn add" onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
  </div>

  <div class="actions">
    <strong>‡∏£‡∏ß‡∏° <span id="grand">0.00</span> ‡∏ö‡∏≤‡∏ó</strong>
    <div>
      <button class="btn add" id="installBtn" style="display:none">‚¨áÔ∏è ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ</button>
      <button class="btn add" onclick="exportData()">üíæ ‡πÄ‡∏ã‡∏ü</button>
      <button class="btn add" onclick="importData()">üìÇ ‡∏Å‡∏π‡πâ</button>
      <input type="file" id="importFile" hidden>
    </div>
  </div>
</div>

<!-- popup -->
<div class="popup-backdrop" id="popup">
  <div class="popup" id="popupBox">
    <h3 id="popupTitle"></h3>
    <p id="popupMsg"></p>
    <div class="popup-actions" id="popupActions"></div>
  </div>
</div>

<script>
/* popup */
function showPopup({title,msg,actions=[]}){
  popupTitle.innerText=title;
  popupMsg.innerText=msg||'';
  popupActions.innerHTML='';
  actions.forEach(a=>{
    const b=document.createElement('button');
    b.className='btn '+(a.type||'ghost');
    b.innerText=a.label;
    b.onclick=()=>{closePopup();a.onClick&&a.onClick()};
    popupActions.appendChild(b);
  });
  popup.style.display='flex';
  requestAnimationFrame(()=>popupBox.classList.add('show'));
}
function closePopup(){
  popupBox.classList.remove('show');
  setTimeout(()=>popup.style.display='none',200);
}

/* PWA install */
let deferredPrompt;
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault();
  deferredPrompt=e;
  installBtn.style.display='inline-block';
});
installBtn.onclick=async()=>{
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  installBtn.style.display='none';
};
if('serviceWorker'in navigator){
  navigator.serviceWorker.register('/TRO/sw.js');
}

/* logic */
const tbody=document.getElementById('tbody');
const monthPicker=document.getElementById('monthPicker');

function addRow(){
  if(!monthPicker.value){
    showPopup({title:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',msg:'‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'});
    return;
  }
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td></td>
    <td><input></td>
    <td>
      <div class="img-box">
        <span class="img-hint">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ</span>
        <input type="file" hidden>
      </div>
    </td>
    <td><input></td>
    <td><input type="number" class="buy" value="0"></td>
    <td><input type="number" class="price" value="0"></td>
    <td class="sum">0.00</td>
    <td><button class="btn-del">üóë</button></td>`;
  tbody.appendChild(tr);
  bindRow(tr);
  renumber(); calc();
}

function bindRow(tr){
  tr.querySelector('.btn-del').onclick=()=>{
    showPopup({
      title:'‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
      msg:'‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà',
      actions:[
        {label:'‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'},
        {label:'‡∏•‡∏ö',type:'danger',onClick:()=>{tr.remove();renumber();calc();}}
      ]
    });
  };
  tr.querySelectorAll('input').forEach(i=>i.oninput=calc);
}

function renumber(){
  [...tbody.children].forEach((tr,i)=>tr.children[0].innerText=i+1);
}
function calc(){
  let g=0;
  tbody.querySelectorAll('tr').forEach(tr=>{
    const b=tr.querySelector('.buy')?.value||0;
    const p=tr.querySelector('.price')?.value||0;
    const s=b*p;
    tr.querySelector('.sum').innerText=s.toFixed(2);
    g+=s;
  });
  grand.innerText=g.toFixed(2);
}

function exportData(){
  showPopup({title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß',msg:'‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÄ‡∏ã‡∏ü‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'});
}
function importData(){
  showPopup({title:'‡∏Å‡∏π‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',msg:'‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô'});
}
</script>
</body>
</html>

